name: Render SAEMIN_K_A3 PDF

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  render-pdf:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Quarto CLI
        uses: quarto-dev/quarto-actions/setup@v2

      - name: Install system deps (R, TeX)
        run: |
          sudo apt-get update -y
          # Install R and tex packages (R provides Rscript)
          sudo apt-get install -y --no-install-recommends \
            r-base r-base-core \
            texinfo texlive-latex-recommended texlive-latex-extra texlive-fonts-recommended \
            texlive-fonts-extra fonts-dejavu-core

      - name: Prepare R user library and install R packages (user lib)
        env:
          R_LIBS_USER: ${{ runner.temp }}/R_libs   # use runner.temp (writable) or $HOME/R/library
        run: |
          # make the user library directory and ensure R sees it
          R_LIB="${R_LIBS_USER}"
          mkdir -p "$R_LIB"
          echo "R user lib: $R_LIB"
          # install tinytex + helper packages into the user library
          Rscript -e "install.packages(c('tinytex','readr','knitr','kableExtra','dplyr','stringr'), repos='https://cloud.r-project.org', lib = Sys.getenv('R_LIBS_USER'))"
          # install TinyTeX into the user home (no sudo)
          Rscript -e "tinytex::install_tinytex(dir = Sys.getenv('RUNNER_TEMP'))"
        shell: bash

      - name: Render Quarto document to PDF
        uses: quarto-dev/quarto-actions/render@v2
        with:
          render-command: quarto render SAEMIN_K_A3.qmd --to pdf --output SAEMIN_K_A3.pdf
          working-directory: ./

      - name: Upload artifact (PDF)
        uses: actions/upload-artifact@v4
        with:
          name: SAEMIN_K_A3_pdf
          path: SAEMIN_K_A3.pdf
